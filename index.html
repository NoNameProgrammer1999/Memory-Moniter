<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="icon" type="image/svg+xml"
href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text x='50%' y='70%' text-anchor='middle' font-size='80'>‚ù§Ô∏è</text></svg>">

<title>Memory Gallery</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic&display=swap');

body{
  font-family:'Zen Maru Gothic',sans-serif;
  background:linear-gradient(180deg,#fffaf3,#ffeef2);
  margin:0;
}

header{
  text-align:center;
  padding:24px;
  background:#ffffffcc;
}

.container{max-width:900px;margin:auto;padding:20px;}

.form-box{
  background:#fff;
  padding:20px;
  border-radius:20px;
  box-shadow:0 8px 24px rgba(0,0,0,.06);
}

input,textarea{
  width:100%;
  margin-bottom:12px;
  padding:10px;
  border-radius:12px;
  border:1px solid #f0d7df;
}

button{
  background:#e97aa2;
  color:#fff;
  border:none;
  padding:10px 18px;
  border-radius:999px;
  cursor:pointer;
}

.gallery{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
  gap:20px;
  margin-top:30px;
}

.card{
  position:relative;
  background:#fff;
  border-radius:20px;
  overflow:hidden;
  box-shadow:0 10px 26px rgba(0,0,0,.08);
}

.card img{
  width:100%;
  height:200px;
  object-fit:cover;
  cursor:pointer;
}

.delete{
  position:absolute;
  top:8px;
  right:8px;
  background:#fff;
  border:none;
  border-radius:50%;
  width:30px;
  height:30px;
  cursor:pointer;
}

.text{padding:14px}

/* MODAL */
.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.8);
  justify-content:center;
  align-items:center;
}

.modal img{
  max-width:90%;
  max-height:90%;
  border-radius:20px;
}
</style>
</head>

<body>

<header>
  <h1>üíñ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏£‡∏á‡∏à‡∏≥‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤</h1>
</header>

<div class="container">

<!-- ‚úÖ FORM POST -->
<div class="form-box">
  <form id="memoryForm"
        action="https://script.google.com/macros/s/AKfycbz44wxO2IImpFOxM9D_kRYnGr8eKZjxejBz2w_1Q-bwcFu0LHnyoIvUGzH2scHmAcANQA/exec"
        method="POST"
        enctype="multipart/form-data"
        target="hidden_iframe"
        onsubmit="afterSubmit()">

    <input type="file" name="image" accept="image/*" required>
    <textarea name="text" placeholder="‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏£‡∏á‡∏à‡∏≥..."></textarea>
    <button type="submit">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
  </form>
</div>

<div class="gallery" id="gallery"></div>
</div>

<iframe name="hidden_iframe" style="display:none"></iframe>

<!-- MODAL -->
<div class="modal" id="modal" onclick="closeModal()">
  <img id="modalImg">
</div>

<script>
/* ===== CONFIG ===== */
const API_URL = 'https://script.google.com/macros/s/AKfycbyxmqOjWHyHcTpr1fg71d5fguQ8zHsdDMu68v0U-fXuLEC9kx4aKmsWdmajsopqpzIt5w/exec';

/* ===== AFTER SUBMIT ===== */
function afterSubmit(){
  setTimeout(() => {
    document.getElementById('memoryForm').reset();
    loadFromAPI();
  }, 1200);
}

/* ===== JSONP LOAD ===== */
window.loadMemories = function(data){
  const gallery = document.getElementById('gallery');
  gallery.innerHTML = '';

  data.reverse().forEach(d=>{
    const c = document.createElement('div');
    c.className = 'card';
    c.innerHTML = `
      <img src="${d.image}" onclick="openModal(this.src)">
      <div class="text">${d.text}</div>
    `;
    gallery.appendChild(c);
  });
};

function loadFromAPI(){
  const old = document.getElementById('jsonp');
  if(old) old.remove();

  const s = document.createElement('script');
  s.id = 'jsonp';
  s.src = API_URL + '?callback=loadMemories';
  document.body.appendChild(s);
}

/* ===== MODAL ===== */
function openModal(src){
  modal.style.display = 'flex';
  modalImg.src = src;
}
function closeModal(){
  modal.style.display = 'none';
}

loadFromAPI();
</script>

</body>
</html>
